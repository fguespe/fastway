function copy_to_clipboard(idobj) {
    jQuery('#'+idobj).show();
    var copyText = document.getElementById(idobj);

  /* Select the text field */
  copyText.select();

  /* Copy the text inside the text field */
  document.execCommand("copy");

  /* Alert the copied text */
  alert("URL del producto copiada!");
  jQuery('#'+idobj).hide();
}

function debounce(func, wait, immediate) {
  var timeout;
  return function() {
    var context = this, args = arguments;
    var later = function() {
      timeout = null;
      if (!immediate) func.apply(context, args);
    };
    var callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) func.apply(context, args);
  };
};
function applySearch(tipo){

  var jQuerysearchWrap = jQuery('.fw_search_form.'+tipo),
      jQuerysearchField = jQuery('.fw_search_form.'+tipo+' .search-field'),
      jQueryloadingIcon = jQuery('.fw_search_form.'+tipo+' .loading'),
      termExists = "";

    // Add results container and disable autocomplete on search field
  jQuerysearchWrap.append('<div class="results"></div>');
  var jQuerysearchResults = jQuery('.fw_search_form.'+tipo+' .results');
  jQuerysearchField.attr('autocomplete', 'off');
  
  // Perform search on keyup in search field, hide/show loading icon
  jQuerysearchField.keyup( function() {
    jQueryloadingIcon.css('display', 'block');
    
    // If the search field is not empty, perform the search function
    if( jQuerysearchField.val() !== "" ) {
      termExists = true;
      doSearch();
    } else {
      termExists = false;
      jQuerysearchResults.empty();
      jQueryloadingIcon.css('display', 'none');
    }
  });
  
  // Make search Ajax request every 200 milliseconds, output results
  var doSearch = debounce(function() {
    var query = jQuerysearchField.val();
    jQuery.ajax({
      type: 'POST',
      url: ajaxurl, // ajaxurl comes from the localize_script we added to functions.php
      data: {
        action: 'ajax_search',
        query: query,
      },
      success: function(result) {
        if ( termExists ) {
          // `result` here is what we've specified in ajax-search.php
          jQuerysearchResults.html('<div class="results-list">' + result + '</div>');
        }
      },
      complete: function() {
        // Whether or not results are returned, hide the loading icon once the request is complete
        jQueryloadingIcon.css('display', 'none');
      }
    });
  }, 200);
}

jQuery( document ).on( 'updated_cart_totals', function(){
  updateEnvioGratisME();
  updateflete();
});
function checkpostalCode(){
  console.log(jQuery('#billing_postcode').empty())
  if(jQuery('#billing_postcode').length && !jQuery('#billing_postcode').val()){
    var msg = window.prompt("Complete su código postal para poder calcular su envío", "");
    jQuery('#billing_postcode').val(msg)
  }
}
jQuery(document).on( 'updated_checkout', function(){
  updateEnvioGratisME();
  //Actualizo todo pago
  updateflete();

  jQuery('li.payment_method_todopago label').html('Todo pago <img src="https://todopago.com.ar/sites/todopago.com.ar/files/boton_192x55_ahora3y6.png" alt="" />')
  
  setTimeout( function() {
    checkpostalCode();
  }, 5000 );
  
});
function updateflete(){

  let buscar="label:contains('Radio de 10km (Canning)')"
  var element =jQuery(buscar);
  if(element){
    jQuery( "<br><b>Fletes:</b>" ).insertBefore( element.closest('li') );

  }
  buscar="label:contains('Munro')"
  element =jQuery(buscar);
  if(element){
    jQuery( "<br><b>Otros:</b>" ).insertAfter( element.closest('li') );

  }
}


function updateEnvioGratisME(){
    //Cambio el label a mercadoenvios gratis
    let dias=['(2-4 días)','(1-3 días)','(3-5 días)'];
    let tipos=["Envío Gratis",'Normal a domicilio'];
    for(let j in tipos){
      let label=tipos[j];
      for(let i in dias){
        let freecuando=dias[i]
        let buscar="label:contains('"+label+" "+freecuando+"')"
        var element =jQuery(buscar);
        if(element && label==tipos[0]){  
          element.text('Envio Gratis Por Correo A Domicilio '+freecuando+'');
          element.addClass('mercadoenvios-shipping free');
        }else if(element && label==tipos[1]){  
          element.html('Correo a domicilio '+freecuando+' \n*Pagando con mercadopago');
          element.addClass('mercadoenvios-shipping ');
          
        }
      }
    }
}

function addCant(index,cart_item_key,sum){
  toggleloading(index)
  jQuery.get(ajaxurl,
  {'action': 'sum_cart_qty',cart_item_key:cart_item_key,sum:sum}, 
  function (msg) { 
      toggleloading(index)
      updatecant(index,sum)
  });
}

function getUpdatedPriceCart(){
  jQuery.get(ajaxurl,
  {'action': 'cart_get_subtotal'}, 
  function (totals) { 
      console.log(totals)
      jQuery('#total').text(totals.subtotal)
  });
}
function updatecant(index,sum){

  let actual=parseInt(jQuery('#qty_'+index).val())
  let precio=parseInt(jQuery('#lineprice_'+index).data('price'))
  let total=parseInt(actual+sum)
  let lineprice=parseInt(total)*parseInt(precio)
  let format='$' + parseFloat(lineprice, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()
  
  jQuery('#qty_'+index).val(total)
  jQuery('#qtyx_'+index).text(total)
  jQuery('#lineprice_'+index).text(format)
  this.getUpdatedPriceCart();
}
function toggleloading(index){
  jQuery('#loadingshow_'+index).toggle();jQuery('#loadinghide_'+index).toggle();
  jQuery('#loadingshow_totals').toggle();jQuery('#loadinghide_totals').toggle();
}

function remove(index,cart_item_key){
  toggleloading(index)
  jQuery.get(ajaxurl,
  {'action': 'cart_remove_item',cart_item_key:cart_item_key}, 
  function (msg) { 
      toggleloading(index)
  });
}


jQuery(document).ready( function(jQuery) {

  setTimeout( function() {
    jQuery('.fw_variations select').trigger('check_variations');
  }, 100 );
  
	applySearch("desktop");
	applySearch("mobile");
	jQuery(document).on('click', '#main-menu .dropdown-menu', function (e) {
		//e.preventDefault();
	  	e.stopPropagation();
	});
	jQuery(document).on('click', '#main-menu-mobile .dropdown-menu', function (e) {
		//e.preventDefault();
	  	e.stopPropagation();
	});
  jQuery(document).on('click', '#page-wrapper', function (e) {
    jQuery('.offcanvas-collapse.open').toggleClass('open');
    jQuery('.fw_menu_mobile').removeClass('opened');
    jQuery('.mobile-menu-overlay').removeClass('opened');
  });
  jQuery('[data-toggle="offcanvas"]').on('click', function () {
    jQuery('.offcanvas-collapse').toggleClass('open');
  });
  jQuery('.btn-bars-mobile').click(function(){
      jQuery('.fw_menu_mobile').addClass('opened');
      jQuery('.mobile-menu-overlay').addClass('opened');
  });    

  jQuery('.mobile-menu-overlay').click(function(){
    jQuery('.fw_menu_mobile').removeClass('opened');
    jQuery('.mobile-menu-overlay').removeClass('opened');
    jQuery('.sidebar-mobile-cats').removeClass('opened');
    });      
   
jQuery('.btn-bars-mobile-cats').click(function(){

      jQuery('.sidebar-mobile-cats').addClass('opened');
      jQuery('.mobile-menu-overlay').addClass('opened');
  });   
  //var hoverTimeout;
//Megamenu/Desktop
  jQuery('#fw_menu li').hover(function() {
      jQuery(this).find('.dropdown-menu.first').show();
  });
  jQuery('#fw_menu .dropdown-submenu').hover(function() {
    jQuery(this).find('.dropdown-menu.second').show();
  });
  jQuery('#fw_menu li').mouseleave(function() {
    jQuery(this).find('.dropdown-menu.first').hide();
  });
  jQuery('#fw_menu .dropdown-submenu').mouseleave(function() {
    jQuery(this).find('.dropdown-menu.second').hide();
  });
  jQuery('.bottom #fw_menu li.dropdown').hover(function() {
    jQuery('.submenu-overlay').addClass('active');

  });
  jQuery('.bottom #fw_menu li.dropdown').mouseleave(function() {
    jQuery('.submenu-overlay').removeClass('active');

  });

  //Dropdown mpbile
  jQuery('#main-menu-mobile li').click(function() {

    jQuery('.dropdown-menu').hide();
    jQuery(this).find('.dropdown-menu').show();

});
});

jQuery(document).click(function(e) {
  if ((e.target != jQuery('.offcanvas')[0]) && (e.target != jQuery('.offcanvas-toggle')[0]) && (jQuery('body').hasClass('offcanvas-expanded'))) {
    var li_tags = jQuery(jQuery('.offcanvas')[0]).find('li');
    var a_tags = jQuery(jQuery('.offcanvas')[0]).find('a');
    for (var i = 0; i < li_tags.length; i++) {
      if (e.target == li_tags[i] || e.target == a_tags[i]) {
        return;
      }
    }
    jQuery('.offcanvas-collapse').toggleClass('open');
  }
  
});

if (jQuery('#back-to-top').length) {
    var scrollTrigger = 100, // px
        backToTop = function () {
            var scrollTop = jQuery(window).scrollTop();
            if (scrollTop > scrollTrigger) {
                jQuery('#back-to-top').addClass('show');
            } else {
                jQuery('#back-to-top').removeClass('show');
            }
        };
    backToTop();
    jQuery(window).on('scroll', function () {
        backToTop();
    });
    jQuery('#back-to-top').on('click', function (e) {
        e.preventDefault();
        jQuery('html,body').animate({
            scrollTop: 0
        }, 700);
    });
}



/*SINGLE PRODUCTS
if (jQuery('form.variations_form').length !== 0) {
  var form = jQuery('form.variations_form');
  var variable_product_price = '';
  setInterval(function() {
      
      if (jQuery('.single_variation_wrap span.price').length !== 0) {
        if (jQuery('.single_variation_wrap span.price').text() !== variable_product_price[0]) {
              variable_product_price = jQuery('.woocommerce-variation-price span.price .amount');
              let preciovariacion=variable_product_price.clone().children().remove().end().text()
              let suffix=jQuery('#fwprice .precio .suffix').text()
              jQuery('#fwprice .precio').html('<span class="fw_price price1"><span class="precio">$'+preciovariacion+'<span class="suffix">'+suffix+'</span></span></span>');
        }
      }
  }, 500);
}*/

jQuery(window).scroll(function(){
  var jQueryaltoScroll = jQuery('.fw_single_product').height() - 350;
  if (jQuery(this).scrollTop() > jQueryaltoScroll) {
      jQuery('.fw_single_product .summary').toggleClass('fixed');
  }            
});    


(function($){

	'use strict'

	$(function(){

		$('#wscp-button').on('click',function(){
			if( $('#wscp-postcode').val().length < 3 ) {

				$('#wscp-postcode').focus();

				return;
			}

			$('#wscp-response').html('');

			var detected = detect_product_variation();
			console.log(detected)
			if( !detected ) {

				$('#wscp-response').fadeOut('fast',function(){

					$(this).html("<div class='woocommerce-message woocommerce-error'>Seleccionar una de las opciones variables.</div>").fadeIn('fast');

				});
					
			
			} else {

				$('#wscp-button').addClass('loading');

				$.ajax({

					type : 'post',
					url  : wscp_admin_url + '?action=wscp_ajax_postcode',
					data : {

						product  : detected,
						qty      : ( $('.quantity input.qty').length ? $('.quantity input.qty').val() : 1 ),
						postcode : $('#wscp-postcode').val(),
						nonce    : $('#wscp-nonce').val()

					},
					success: function(response){


						$('#wscp-response').fadeOut('fast',function(){

							$(this).html(response).fadeIn('fast');
							$('#wscp-button').removeClass('loading');

						});
					}
				});
			}

		});

		$('form.cart, #wscp-postcode').on('keypress', function(e) {
		 	
		 	var keyCode = e.keyCode || e.which;
			
			if (keyCode === 13) { 

				$('#wscp-button').click();
		    	e.preventDefault();
		    	return false;
		  	}
		});

	});


})(jQuery);

	
function detect_product_variation() {
	return jQuery('.fw_add_to_cart_button').data("product_id")
}